# 前言

网上流传的GetDict2.6和2.3版本支持直接将mdx转为idx文件(但开发者还在维护的MdxExport3.6已经放弃对这一功能的支持)，但是考虑到，网上的各种教程一般都是有关英文，对于日语词典涉及不多，所以写这篇文章记录如何把mdx转StarDict时如何处理@@@语法，算是抛砖引玉，希望对大家有所帮助。同时也在文末会附上处理过程中自己的疑问，欢迎大家与我交流。

# 总流程

先总结下流程

1. **Mdx转为txt源文件** 参考这篇[安卓版Goldendict支持.mdx.mdd的方法(经验)](https://www.pdawiki.com/forum/thread-15291-1-1.html),按照文章所述用GetDict2.6把mdx转成txt文件即可,不一定非要用正则表达式处理——之后处理可能会产生一些小问题，到时候一起处理;
2. **处理@@@问题** 借鉴这篇[Python辅助MDX转MOBI（以AHD5th为例）](https://www.bilibili.com/read/cv11110087)，文章从第三步开始就是与制作mobi词典有关的内容，所以只看前2步用就可以了。
3. **txt转mdx**,使用欧路词典官方提供的MdxBuilder,下载地址:https://www.eudic.net/v4/en/home/EudicBuilder
4. **修改格式**，灵感还是源于这篇[安卓版Goldendict支持.mdx.mdd的方法(经验)](https://www.pdawiki.com/forum/thread-15291-1-1.html)，但实际操作中没有套用文章的正则表达式；如果下一步没有遇到报错或者查词没有问题，可以跳过；
5. **Mdx转StarDict** 参考[[经验交流]mdx如何转为StarDict格式[20160119]](https://www.pdawiki.com/forum/thread-15291-1-1.html)。

上面5步,最麻烦的是处理@@@和修改格式,所以下面列出了整个过程的的处理思路，也包括自己遇到的一些问题，所以逻辑比较乱，建议自己动手处理遇到问题时当作文档来查。

# 处理好@@@问题

直接利用[Python辅助MDX转MOBI（以AHD5th为例）](https://www.bilibili.com/read/cv11110087)提供的脚本也能达到目的,但我在原作者分享的脚本做了如下修改,这里做个简单说明:
- 利用`pyinstaller`对源码进行了打包,现在不用安装Python也可以用了,打包好的文件在dist文件夹下；
- 修改文件路径的语法，现在只需将待处理的txt重命名为`待处理.txt`放在exe同一目录下即可,但是；
- 删除了`print()`语句，处理过程没有任何提示；主要是因为命令行一次最多处理的字符有上限，运行我提供的文件的话，会在一段时间后自动停止运行,不过处理完命令行界面不会关闭；
- 启动后命令行不会有任何提示，处理完成后命令行界面会自动关闭。可以观察文件访问时间，掌握处理状态![观察文件访问时间]()。


## 修改格式

直接将上述处理好的txt文件丢到MDX？会提示报错![未调整格式的报错信息]()

作者除了阅读文档之外,还观察了手里一本可以直接转换的词典格式特点，然后手动用正则表达式替换，不保证能解决所有问题。下面谈到3点,难度依次递增,但重要程度递减,请结合自己的能力与时间尝试-欢迎-每本词典都有各自特点,处理起来很花时间,如果你觉得词典对你很重要,请寻找提供这种帮助的人,或者

* 遇到问题的话,看看欧路词典提供的下载文件中的`manual_Chn.txt`，尤其是这句`(注意"</>"和下一个记录间不要有任何其他空行，请参考example.txt中的例子)`和这句`每个项目两行第一行是关键字第二行开始是正文, 这里的正文应该包括关键字。`,问题多半出在文件格式不满足这2点
* 有强迫症的：去除没用的辅助说明文字`<!-- /.ex 解説 -->`,
* 去除跳转语法`<a href="entry://(.*?)">(.*?))</a>`,如果有需要,还可以删除图片有关的内容节约空间,虽然这篇[安卓版Goldendict支持.mdx.mdd的方法(经验)](https://www.pdawiki.com/forum/thread-15291-1-1.html)给出了显示图片的方法，但我用这种格式的词典只是在kindle3和博阅P10(都看不清……)，具体操作就不多说了，无法照搬，只能根据经验一点点删,有兴趣的自己摸索

![报错提示](https://markdoen-1304943362.cos.ap-nanjing.myqcloud.com//2021-11-04-18-43-10.png)

注意这里的数字不是行数，是字节数，以EmEdiotor为例，快捷键’Ctrl+G‘输入报错信息的位置，跳转到相应位置检查即可

![跳转检查](https://markdoen-1304943362.cos.ap-nanjing.myqcloud.com//2021-11-04-19-13-11.png)

![](https://markdoen-1304943362.cos.ap-nanjing.myqcloud.com//2021-11-04-18-43-35.png)
说明就要成功了,此时生成的文件全是0kb是正常情况,耐心等待即可

![MDXbuilder](https://markdoen-1304943362.cos.ap-nanjing.myqcloud.com//2021-11-04-19-11-24.png)